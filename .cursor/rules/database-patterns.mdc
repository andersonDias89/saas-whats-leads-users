---
globs: *.prisma,src/app/api/**/*.ts
---
# PadrÃµes de Banco de Dados - Cursor SaaS WhatsApp Leads

## ğŸ—„ï¸ Status em PortuguÃªs

### âœ… Correto:
```typescript
// Frontend
const statusOptions = [
  { value: 'novo', label: 'Novo' },
  { value: 'contactado', label: 'Contactado' },
  { value: 'convertido', label: 'Convertido' }
]

// Backend (Prisma)
model Lead {
  status String @default("novo")
}
```

### âŒ Evitar:
```typescript
// Misturar idiomas
{ value: 'new', label: 'Novo' }
{ value: 'contacted', label: 'Contactado' }
```

## ğŸ”— Relacionamentos

### âœ… Correto:
```typescript
// Sempre incluir relacionamentos necessÃ¡rios
const lead = await prisma.lead.findFirst({
  where: { id },
  include: {
    conversation: true,
    user: true
  }
})
```

## ğŸ“± Webhook e Leads

### âœ… CriaÃ§Ã£o de Lead via Webhook:
```typescript
// Criar ou atualizar lead
let lead = await prisma.lead.findFirst({
  where: {
    userId: user.id,
    phone: from
  }
})

if (!lead) {
  lead = await prisma.lead.create({
    data: {
      userId: user.id,
      conversationId: conversation.id,
      name: profileName || waId || from,
      phone: from,
      status: 'novo', // SEMPRE em portuguÃªs
      source: 'whatsapp'
    }
  })
}
```

## ğŸš¨ Regras Importantes
- **Status sempre em portuguÃªs** (`'novo'`, `'contactado'`, `'convertido'`)
- **Incluir relacionamentos** quando necessÃ¡rio
- **Usar default values** do Prisma schema
- **Validar dados** antes de salvar

## ğŸ“š ReferÃªncias
- [prisma/schema.prisma](mdc:prisma/schema.prisma) - Schema do banco
- [docs/best-practices.md](mdc:docs/best-practices.md) - PadrÃµes gerais
