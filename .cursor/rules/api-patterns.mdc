---
globs: src/app/api/**/*.ts
---
# PadrÃµes de API - Cursor SaaS WhatsApp Leads

## ğŸŒ Rotas de API

### âœ… Correto:
```
/api/conversations/webhook
/api/leads
/api/users
```

### âŒ Evitar:
```
/conversations/webhook  # Fora de /api/
```

## ğŸ” ValidaÃ§Ã£o com Zod

### âœ… Correto:
```typescript
import { z } from 'zod'

const webhookSchema = z.object({
  From: z.string(),
  To: z.string(),
  Body: z.string()
})

export async function POST(req: NextRequest) {
  const data = await req.json()
  const validatedData = webhookSchema.parse(data)
}
```

## ğŸ›¡ï¸ Tratamento de Erros

### âœ… Correto:
```typescript
try {
  const result = await prisma.lead.create({ data })
  return NextResponse.json(result)
} catch (error) {
  console.error('Erro ao criar lead:', error)
  return NextResponse.json(
    { message: 'Erro interno do servidor' },
    { status: 500 }
  )
}
```

## ğŸ“± Webhook Twilio

### âœ… Estrutura Correta:
```typescript
// src/app/api/conversations/webhook/route.ts
export async function POST(req: NextRequest) {
  // Parse form data (Twilio envia como form-data)
  const contentType = req.headers.get('content-type')
  
  let data = {}
  if (contentType?.includes('multipart/form-data')) {
    const formData = await req.formData()
    data = Object.fromEntries(formData.entries())
  } else {
    const text = await req.text()
    const urlParams = new URLSearchParams(text)
    data = Object.fromEntries(urlParams.entries())
  }
  
  // Validar com Zod
  const validatedData = twilioWebhookSchema.parse(data)
}
```

## ğŸš¨ Regras Importantes
- **Sempre validar dados** com Zod antes de processar
- **Tratar erros** adequadamente com try/catch
- **Usar status codes** apropriados nas respostas
- **Logs informativos** para debugging

## ğŸ“š ReferÃªncias
- [docs/best-practices.md](mdc:docs/best-practices.md) - PadrÃµes gerais
- [src/schemas/index.ts](mdc:src/schemas/index.ts) - Schemas disponÃ­veis
